<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Project Details â€“ Professional Showcase</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="shareable.css" media="all">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --primary: #007bff;
      --secondary: #6c757d;
      --text: #333;
      --background: #fff;
      --card-bg: #f9f9f9;
      --border: #e0e0e0;
    }

    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background: var(--background);
      color: var(--text);
      line-height: 1.6;
    }

    .main-navigation-nav {
      position: fixed;
      top: 0;
      width: 100%;
      background: var(--background);
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
    }

    .main-navigation-logo {
      height: 50px;
    }

    .main-navigation-nav-links a {
      margin-left: 2rem;
      text-decoration: none;
      color: var(--text);
      font-weight: 600;
    }

    .cta-button {
      background: var(--primary);
      color: #fff;
      padding: 0.5rem 1rem;
      border-radius: 4px;
    }

    .main-navigation-hamburger {
      display: none;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      margin: 2rem;
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
    }

    .back-link i {
      margin-right: 0.5rem;
    }

    .project-detail {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    .detail-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .project-title {
      font-size: 2.5rem;
      margin: 0;
    }

    .project-meta {
      color: var(--secondary);
      font-size: 1.1rem;
    }

    .detail-image {
      width: 100%;
      max-height: 500px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 2rem;
    }

    .detail-content {
      margin-bottom: 2rem;
    }

    .project-description {
      font-size: 1.1rem;
    }

    .testimonial-section, .youtube-section {
      margin: 2rem 0;
    }

    .testimonial-section h2, .youtube-section h2 {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 1.5rem;
    }

    .testimonial-container, .youtube-container {
      position: relative;
      overflow: hidden;
    }

    .testimonial-slider, .youtube-slider {
      display: flex;
      transition: transform 0.5s ease;
    }

    .testimonial-item, .youtube-item {
      min-width: 100%;
      padding: 1rem;
    }

    .testimonial-quote {
      font-style: italic;
      margin-bottom: 1rem;
    }

    .testimonial-author {
      font-weight: 600;
    }

    .youtube-item iframe {
      width: 100%;
      height: 400px;
      border: none;
      border-radius: 8px;
    }

    .youtube-title {
      margin-top: 1rem;
      font-weight: 600;
    }

    .detail-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }

    .detail-item h3 {
      margin-bottom: 0.5rem;
    }

    .skill-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .skill-tag {
      background: var(--primary);
      color: #fff;
      padding: 0.3rem 0.8rem;
      border-radius: 4px;
    }

    .other-project-nav-container {
      display: flex;
      justify-content: space-between;
      margin: 2rem 0;
    }

    .other-project-nav-button {
      display: flex;
      align-items: center;
      text-decoration: none;
      color: var(--primary);
      font-weight: 600;
    }

    .other-project-nav-button i {
      margin: 0 0.5rem;
    }

    .other-project-nav-spacer {
      width: 50%;
    }

    .related-projects {
      margin: 2rem 0;
      padding: 0 2rem;
    }

    .related-projects h2 {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 1.5rem;
      position: relative;
      padding-bottom: 0.5rem;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      color: var(--text);
    }

    .related-projects h2::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: var(--primary);
      border-radius: 2px;
    }

    .project-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
    }

    .related-project {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      color: var(--text);
      text-decoration: none;
      font-family: 'Poppins', sans-serif;
      font-size: 1rem;
    }

    .related-project img {
      width: 100%;
      height: auto;
      border-radius: 8px;
      margin-bottom: 1rem;
    }

    .related-project:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }

    .back-to-top {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: var(--primary);
      color: #fff;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .main-navigation-nav-links {
        display: none;
      }
      .main-navigation-hamburger {
        display: block;
      }
    }
  </style>
</head>
<body>
  <nav class="main-navigation-nav">
    <a href="index.html#home">
      <img src="Header.png" alt="Logo" class="main-navigation-logo">
    </a>
    <div class="main-navigation-nav-links">
      <a href="index.html#home">Home</a>
      <a href="index.html#projects-container">Projects</a>
      <a href="index.html#contact">Contact</a>
      <a href="portfolio-cv.html" class="cta-button">CV / Portfolio</a>
    </div>
    <button class="main-navigation-hamburger">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </nav>

  <br><br><br><br>

  <main id="project-detail-container"></main>

  <div class="back-to-top" title="Back to Top">
    <i class="fas fa-chevron-up"></i>
  </div>

  <script>
    // Global Variables
    const PROJECTS_URL = 'feature-project.json';
    const CATEGORIES_URL = 'feature-project-category.json';
    const detailsContainer = document.getElementById('project-detail-container');
    const urlParams = new URLSearchParams(window.location.search);
    const projectParam = urlParams.get('id');
    const categoryParam = urlParams.get('cat');
    
    let allProjects = [];
    let allCategories = [];
    let galleryImagesGlobal = [];
    const imagesPerPage = 5;
    let currentGalleryPage = 1;
    let currentImageIndex = 0;
    let lightboxInitialized = false;
    
    // Data Fetching with Local Storage
    function getProjectsData() {
      const key = "projectsData";
      return new Promise((resolve, reject) => {
        let data = localStorage.getItem(key);
        if (data) {
          resolve(JSON.parse(data));
        } else {
          fetch(PROJECTS_URL)
            .then(response => {
              if (!response.ok) { reject(new Error('Network response was not ok')); }
              return response.json();
            })
            .then(data => { localStorage.setItem(key, JSON.stringify(data)); resolve(data); })
            .catch(reject);
        }
      });
    }
    
    function getCategoriesData() {
      const key = "categoriesData";
      return new Promise((resolve, reject) => {
        let data = localStorage.getItem(key);
        if (data) {
          resolve(JSON.parse(data));
        } else {
          fetch(CATEGORIES_URL)
            .then(response => {
              if (!response.ok) { reject(new Error('Network response was not ok')); }
              return response.json();
            })
            .then(data => { localStorage.setItem(key, JSON.stringify(data)); resolve(data); })
            .catch(reject);
        }
      });
    }
    
    async function fetchData() {
      try {
        allProjects = await getProjectsData();
        allCategories = await getCategoriesData();
      } catch (error) {
        console.error('Error loading data:', error);
      }
    }
    
    // Initialization
    async function initPage() {
      await fetchData();
      if (categoryParam) {
        const category = allCategories.find(c => c.id === Number(categoryParam));
        if (category) {
          const filteredProjects = allProjects.filter(
            p => p["project-feature-main-category-id"] === Number(categoryParam) &&
                 p["feature-project-type"] === "un-highlighted"
          );
          renderCategoryDetails(category, filteredProjects);
          initLightbox();
        } else { showDetailError(); }
      } else if (projectParam) {
        const project = allProjects.find(p => p.id === Number(projectParam));
        if (project) {
          renderProjectDetails(project, allProjects);
          initLightbox();
        } else { showDetailError(); }
      } else { showDetailError(); }
    }
    
    // Helper Function for Navigation
    function getNavigationProjects(project, allProjects) {
      const highlightedProjects = allProjects
        .filter(p => p["feature-project-type"] === "highlighted")
        .sort((a, b) => a["feature-project-order"] - b["feature-project-order"]);
      const currentIndex = highlightedProjects.findIndex(p => p.id === project.id);
      if (currentIndex === -1) {
        return { prevProject: null, nextProject: null };
      }
      const prevProject = currentIndex > 0 ? highlightedProjects[currentIndex - 1] : null;
      const nextProject = currentIndex < highlightedProjects.length - 1 ? highlightedProjects[currentIndex + 1] : null;
      return { prevProject, nextProject };
    }
    
    // Suggest Related Projects
    function getRelatedProjects(currentProjectId, allProjects) {
      const currentProject = allProjects.find(p => p.id === currentProjectId);
      if (!currentProject) return [];
    
      const sameClientProjects = allProjects.filter(p => 
        p["feature-project-client"] === currentProject["feature-project-client"] && 
        p.id !== currentProjectId
      );
      const sameCategoryProjects = allProjects.filter(p => 
        p["project-feature-main-category-id"] === currentProject["project-feature-main-category-id"] && 
        p.id !== currentProjectId
      );
    
      let relatedProjects = sameClientProjects;
      if (relatedProjects.length < 3) {
        const additionalProjects = sameCategoryProjects.filter(p => !relatedProjects.includes(p));
        relatedProjects = relatedProjects.concat(additionalProjects.slice(0, 3 - relatedProjects.length));
      }
    
      return relatedProjects.slice(0, 3);
    }
    
    // Single Project View
    function renderProjectDetails(project, projects) {
      const { prevProject, nextProject } = getNavigationProjects(project, projects);
      const testimonials = project["feature-project-testimonial"] && 
                           Array.isArray(project["feature-project-testimonial"]) ? 
                           project["feature-project-testimonial"].filter(t => t["testimonial-quote"] && t["testimonial-quote"] !== null) : [];
      const hasTestimonials = testimonials.length > 0;
      const testimonialCount = testimonials.length;
      const testimonialSectionTitle = testimonialCount === 1 ? 'Testimonial' : 'Testimonials';
    
      const youtubeVideos = project["feature-project-youtube-link"] && 
                            Array.isArray(project["feature-project-youtube-link"]) && 
                            project["feature-project-youtube-link"].length > 0 ? 
                            project["feature-project-youtube-link"].filter(video => video.url && video.url !== null && video.url !== '') : [];
      const hasYouTubeVideos = youtubeVideos.length > 0;
      const videoCount = youtubeVideos.length;
      const youtubeSectionTitle = videoCount === 1 ? 'Video' : 'Videos';
    
      const relatedProjects = getRelatedProjects(project.id, projects);
    
      detailsContainer.innerHTML = `
        <a href="index.html" class="back-link">
          <i class="fas fa-arrow-left"></i> Back to Projects
        </a>
        <article class="project-detail">
          <header class="detail-header">
            <h1 class="project-title">${project["feature-project-name"]}</h1>
            ${project["feature-project-start-year"] ? `
              <div class="project-meta">
                <span>${project["feature-project-start-year"]}${project["feature-project-end-year"] ? ` - ${project["feature-project-end-year"]}` : ''}</span>
              </div>
            ` : ''}
          </header>
          <img src="${project["feature-project-thumbnail"]}" 
               alt="${project["feature-project-name"]}" 
               class="detail-image" loading="lazy">
          <section class="detail-content">
            <p class="project-description">${project["feature-project-long-description"]}</p>
            ${hasTestimonials ? `
              <div class="testimonial-section">
                <h2>${testimonialSectionTitle}</h2>
                <div class="testimonial-container">
                  <div class="testimonial-slider">
                    ${testimonials.map(testimonial => `
                      <div class="testimonial-item">
                        <p class="testimonial-quote">"${testimonial["testimonial-quote"]}"</p>
                        <p class="testimonial-author">${testimonial["testimonial-name"]}</p>
                        <p class="testimonial-role">${testimonial["testimonial-role"]}${testimonial["testimonial-client-name"] ? `, ${testimonial["testimonial-client-name"]}` : ''}</p>
                      </div>
                    `).join('')}
                  </div>
                </div>
                ${testimonialCount > 1 ? `
                  <div class="testimonial-nav">
                    <button class="testimonial-nav-btn prev" aria-label="Previous testimonial">
                      <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="testimonial-nav-btn next" aria-label="Next testimonial">
                      <i class="fas fa-chevron-right"></i>
                    </button>
                  </div>
                  <div class="testimonial-dots">
                    ${testimonials.map((_, index) => `
                      <span class="testimonial-dot${index === 0 ? ' active' : ''}" data-index="${index}"></span>
                    `).join('')}
                  </div>
                ` : ''}
              </div>
            ` : ''}
            ${hasYouTubeVideos ? `
              <div class="youtube-section">
                <h2>${youtubeSectionTitle}</h2>
                <div class="youtube-container">
                  <div class="youtube-slider">
                    ${youtubeVideos
                      .sort((a, b) => a.order - b.order)
                      .map(video => `
                        <div class="youtube-item">
                          <iframe src="${video.url}" 
                                  title="${video.title}" 
                                  allowfullscreen 
                                  loading="lazy"></iframe>
                          <p class="youtube-title">${video.title}</p>
                          <p class="youtube-description">${video.description}</p>
                        </div>
                      `).join('')}
                  </div>
                </div>
                ${videoCount > 1 ? `
                  <div class="youtube-nav">
                    <button class="youtube-nav-btn prev" aria-label="Previous video">
                      <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="youtube-nav-btn next" aria-label="Next video">
                      <i class="fas fa-chevron-right"></i>
                    </button>
                  </div>
                  <div class="youtube-dots">
                    ${youtubeVideos.map((_, index) => `
                      <span class="youtube-dot${index === 0 ? ' active' : ''}" data-index="${index}"></span>
                    `).join('')}
                  </div>
                ` : ''}
              </div>
            ` : ''}
            ${project["feature-project-gallery"] && project["feature-project-gallery"].length ? `
              <div id="gallery-section-container"></div>
            ` : ''}
            <div class="detail-grid">
              ${project["feature-project-company-name"] ? `
                <div class="detail-item">
                  <h3>Company</h3>
                  <p>${project["feature-project-company-name"]}</p>
                </div>
              ` : ''}
              ${project["feature-project-client"] ? `
                <div class="detail-item">
                  <h3>Client</h3>
                  <p>${project["feature-project-client"]}</p>
                </div>
              ` : ''}
              ${project["feature-project-skills"] && project["feature-project-skills"].length ? `
                <div class="detail-item">
                  <h3>Skills Used</h3>
                  <div class="skill-list">
                    ${project["feature-project-skills"].map(skill => `<span class="skill-tag">${skill}</span>`).join('')}
                  </div>
                </div>
              ` : ''}
            </div>
          </section>
          ${prevProject || nextProject ? `
            <nav class="other-project-nav-container">
              ${prevProject ? `
                <a href="details.html?id=${prevProject.id}" class="other-project-nav-button" title="Previous project: ${prevProject["feature-project-name"]}">
                  <i class="fas fa-arrow-left"></i>
                  <span>${prevProject["feature-project-name"]}</span>
                </a>
              ` : '<div class="other-project-nav-spacer"></div>'}
              ${nextProject ? `
                <a href="details.html?id=${nextProject.id}" class="other-project-nav-button" title="Next project: ${nextProject["feature-project-name"]}">
                  <span>${nextProject["feature-project-name"]}</span>
                  <i class="fas fa-arrow-right"></i>
                </a>
              ` : '<div class="other-project-nav-spacer"></div>'}
            </nav>
          ` : ''}
          ${relatedProjects.length > 0 ? `
            <section class="related-projects">
              <h2>Related Projects</h2>
              <div class="project-grid">
                ${relatedProjects.map(p => `
                  <a href="details.html?id=${p.id}" class="related-project">
                    <img src="${p["feature-project-thumbnail"]}" alt="${p["feature-project-name"]}" loading="lazy">
                    <h3>${p["feature-project-name"]}</h3>
                  </a>
                `).join('')}
              </div>
            </section>
          ` : ''}
          ${getLightboxMarkup()}
        </article>
      `;

      if (project["feature-project-gallery"] && project["feature-project-gallery"].length) {
        galleryImagesGlobal = project["feature-project-gallery"].sort((a, b) => a.order - b.order);
        renderGallerySection(galleryImagesGlobal);
      }
      
      if (hasTestimonials && testimonialCount > 1) {
        initTestimonialSlider(testimonialCount);
      }
      
      if (hasYouTubeVideos && videoCount > 1) {
        initYouTubeSlider(videoCount);
      }
    }
    
    // Category View
    function renderCategoryDetails(category, projects) {
      detailsContainer.innerHTML = `
        <a href="index.html" class="back-link">
          <i class="fas fa-arrow-left"></i> Back to Projects
        </a>
        <article class="project-detail">
          <header class="detail-header">
            <h1 class="project-title">${category["feature-project-category-name"]}</h1>
          </header>
          <section class="detail-content">
            <div class="project-grid">
              ${projects.map(project => `
                <a href="details.html?id=${project.id}" class="related-project">
                  <img src="${project["feature-project-thumbnail"]}" alt="${project["feature-project-name"]}" loading="lazy">
                  <h3>${project["feature-project-name"]}</h3>
                </a>
              `).join('')}
            </div>
          </section>
        </article>
      `;
    }
    
    // Error Handling
    function showDetailError() {
      detailsContainer.innerHTML = `
        <article class="project-detail">
          <p>Project or category not found.</p>
          <a href="index.html" class="back-link">Back to Projects</a>
        </article>
      `;
    }
    
    // Lightbox (Simplified)
    function getLightboxMarkup() {
      return `
        <div id="lightbox" class="lightbox">
          <span class="lightbox-close">&times;</span>
          <img class="lightbox-image" src="" alt="Lightbox Image">
          <div class="lightbox-nav">
            <button class="lightbox-prev"><i class="fas fa-chevron-left"></i></button>
            <button class="lightbox-next"><i class="fas fa-chevron-right"></i></button>
          </div>
        </div>
      `;
    }
    
    function renderGallerySection(images) {
      const galleryContainer = document.getElementById('gallery-section-container');
      const startIndex = (currentGalleryPage - 1) * imagesPerPage;
      const endIndex = startIndex + imagesPerPage;
      const paginatedImages = images.slice(startIndex, endIndex);
    
      galleryContainer.innerHTML = `
        <h2>Gallery</h2>
        <div class="gallery-grid">
          ${paginatedImages.map((img, index) => `
            <img src="${img.url}" alt="${img.title || 'Gallery Image'}" 
                 class="gallery-image" 
                 data-index="${startIndex + index}" 
                 loading="lazy">
          `).join('')}
        </div>
        ${images.length > imagesPerPage ? `
          <div class="gallery-pagination">
            <button class="gallery-prev" ${currentGalleryPage === 1 ? 'disabled' : ''}>Previous</button>
            <span>Page ${currentGalleryPage} of ${Math.ceil(images.length / imagesPerPage)}</span>
            <button class="gallery-next" ${endIndex >= images.length ? 'disabled' : ''}>Next</button>
          </div>
        ` : ''}
      `;
    }
    
    function initTestimonialSlider(count) {
      const slider = document.querySelector('.testimonial-slider');
      const prevBtn = document.querySelector('.testimonial-nav-btn.prev');
      const nextBtn = document.querySelector('.testimonial-nav-btn.next');
      const dots = document.querySelectorAll('.testimonial-dot');
      let currentIndex = 0;
    
      function updateSlider() {
        slider.style.transform = `translateX(-${currentIndex * 100}%)`;
        dots.forEach(dot => dot.classList.remove('active'));
        dots[currentIndex].classList.add('active');
      }
    
      prevBtn.addEventListener('click', () => {
        if (currentIndex > 0) {
          currentIndex--;
          updateSlider();
        }
      });
    
      nextBtn.addEventListener('click', () => {
        if (currentIndex < count - 1) {
          currentIndex++;
          updateSlider();
        }
      });
    
      dots.forEach(dot => {
        dot.addEventListener('click', () => {
          currentIndex = Number(dot.dataset.index);
          updateSlider();
        });
      });
    }
    
    function initYouTubeSlider(count) {
      const slider = document.querySelector('.youtube-slider');
      const prevBtn = document.querySelector('.youtube-nav-btn.prev');
      const nextBtn = document.querySelector('.youtube-nav-btn.next');
      const dots = document.querySelectorAll('.youtube-dot');
      let currentIndex = 0;
    
      function updateSlider() {
        slider.style.transform = `translateX(-${currentIndex * 100}%)`;
        dots.forEach(dot => dot.classList.remove('active'));
        dots[currentIndex].classList.add('active');
      }
    
      prevBtn.addEventListener('click', () => {
        if (currentIndex > 0) {
          currentIndex--;
          updateSlider();
        }
      });
    
      nextBtn.addEventListener('click', () => {
        if (currentIndex < count - 1) {
          currentIndex++;
          updateSlider();
        }
      });
    
      dots.forEach(dot => {
        dot.addEventListener('click', () => {
          currentIndex = Number(dot.dataset.index);
          updateSlider();
        });
      });
    }
    
    function initLightbox() {
      const lightbox = document.getElementById('lightbox');
      const lightboxImage = document.querySelector('.lightbox-image');
      const closeBtn = document.querySelector('.lightbox-close');
      const prevBtn = document.querySelector('.lightbox-prev');
      const nextBtn = document.querySelector('.lightbox-next');
      const galleryImages = document.querySelectorAll('.gallery-image');
    
      galleryImages.forEach(img => {
        img.addEventListener('click', () => {
          currentImageIndex = Number(img.dataset.index);
          lightboxImage.src = galleryImagesGlobal[currentImageIndex].url;
          lightbox.style.display = 'flex';
        });
      });
    
      closeBtn.addEventListener('click', () => {
        lightbox.style.display = 'none';
      });
    
      prevBtn.addEventListener('click', () => {
        if (currentImageIndex > 0) {
          currentImageIndex--;
          lightboxImage.src = galleryImagesGlobal[currentImageIndex].url;
        }
      });
    
      nextBtn.addEventListener('click', () => {
        if (currentImageIndex < galleryImagesGlobal.length - 1) {
          currentImageIndex++;
          lightboxImage.src = galleryImagesGlobal[currentImageIndex].url;
        }
      });
    
      lightbox.addEventListener('click', (e) => {
        if (e.target === lightbox) {
          lightbox.style.display = 'none';
        }
      });
    }
    
    // Initialize the page
    initPage();
  </script>
  
  <script src="sharable-scripts.js" defer></script>
</body>
</html>