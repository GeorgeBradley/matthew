<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Un-Highlighted Features Slider</title>
    <style>
      /* Un-Highlighted Features Slider Styles */
      #un-highlighted-features .un-highlighted-features-slider-container {
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
        position: relative;
        margin-bottom: 20px;
      }

      #un-highlighted-features .un-highlighted-features-slider-track {
        display: flex;
        width: auto;
      }

      #un-highlighted-features .un-highlighted-features-slide {
        flex: 0 0 auto;
        scroll-snap-align: start;
        height: 200px; /* Adjust as needed */
        position: relative;
        margin-right: 10px;
      }

      #un-highlighted-features .un-highlighted-features-slide img {
        height: 100%;
        width: auto;
        object-fit: cover;
        display: block;
      }

      /* Category title styling */
      #un-highlighted-features h2 {
        margin: 20px 0 10px;
        font-size: 1.2em;
      }
    </style>
  </head>
  <body>
    <section id="un-highlighted-features">
      <!-- Sliders will be dynamically inserted here -->
    </section>

    <script>
      // Seeded pseudo-random number generator using mulberry32.
      function mulberry32(a) {
        return function() {
          var t = a += 0x6D2B79F5;
          t = Math.imul(t ^ (t >>> 15), t | 1);
          t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
          return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
        };
      }

      // Function to perform a seeded shuffle using the provided seed.
      function seededShuffleArray(array, seed) {
        const random = mulberry32(seed);
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
      }

      function initUnHighlightedFeatures() {
        const section = document.getElementById('un-highlighted-features');
        if (!section) return;

        // URLs for categories and projects JSON.
        const categoriesUrl =
          'https://georgebradley.github.io/matthew/feature-project-category.json';
        const projectsUrl =
          'https://georgebradley.github.io/matthew/feature-project.json'; // Adjust if needed

        Promise.all([
          fetch(categoriesUrl).then((res) => res.json()),
          fetch(projectsUrl).then((res) => res.json())
        ])
          .then(([categories, projects]) => {
            // Filter projects that are un-highlighted.
            const unhighlightedProjects = projects.filter(
              (p) => p['feature-project-type'] === 'un-highlighted'
            );

            // Group projects by their main category id.
            const grouped = {};
            unhighlightedProjects.forEach((project) => {
              const catId = project['project-feature-main-category-id'];
              if (!grouped[catId]) {
                grouped[catId] = [];
              }
              grouped[catId].push(project);
            });

            // For each category, create a slider if there are projects.
            categories.forEach((category) => {
              const catId = category.id;
              if (grouped[catId] && grouped[catId].length > 0) {
                // Add a heading for the category.
                const categoryTitle = document.createElement('h2');
                categoryTitle.textContent = category.categoryName;
                section.appendChild(categoryTitle);

                // Create a link that wraps the slider.
                const link = document.createElement('a');
                link.href =
                  'nextpage.html?category=' +
                  encodeURIComponent(category.categoryName);
                link.className = 'un-highlighted-features-slider-link';

                // Create slider container and track.
                const sliderContainer = document.createElement('div');
                sliderContainer.className =
                  'un-highlighted-features-slider-container';
                const sliderTrack = document.createElement('div');
                sliderTrack.className =
                  'un-highlighted-features-slider-track';

                // Collect slide elements into an array for shuffling.
                const slides = [];

                // For each project in this category, add two slides (from its gallery images).
                grouped[catId].forEach((project) => {
                  const gallery = project['feature-project-gallery'];
                  if (gallery && gallery.length >= 2) {
                    // Use the first two images.
                    for (let i = 0; i < 2; i++) {
                      const slide = document.createElement('div');
                      slide.className = 'un-highlighted-features-slide';

                      const img = document.createElement('img');
                      img.src = gallery[i].image;
                      img.alt =
                        gallery[i]['alt-text'] || project['feature-project-name'];
                      slide.appendChild(img);

                      // Label removed as per request.

                      slides.push(slide);
                    }
                  }
                });

                // Use a fixed seed (e.g., 12345) so that the shuffle order is always the same.
                seededShuffleArray(slides, 12345);
                slides.forEach((slide) => sliderTrack.appendChild(slide));

                sliderContainer.appendChild(sliderTrack);
                link.appendChild(sliderContainer);
                section.appendChild(link);
              }
            });
          })
          .catch((error) => {
            console.error('Error fetching un-highlighted features:', error);
          });
      }

      document.addEventListener('DOMContentLoaded', initUnHighlightedFeatures);
    </script>
  </body>
</html>
