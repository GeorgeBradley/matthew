<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puppetry Arts Portfolio</title>
    <style>
        :root {
            --parchment: #f3e9d2;
            --wood: #6b4f40;
            --gold: #c5a880;
            --shadow: rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Palatino Linotype', 'Book Antiqua', serif;
            background: var(--parchment);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .portfolio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .project-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px var(--shadow);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .project-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px var(--shadow);
        }

        .card-thumbnail {
            height: 240px;
            overflow: hidden;
            position: relative;
        }

        .card-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s;
        }

        .card-content {
            padding: 1.5rem;
            background: linear-gradient(to bottom right, #fff, #f8f4e9);
        }

        .project-type {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--wood);
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .project-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background: var(--parchment);
            max-width: 1200px;
            margin: 2rem auto;
            border-radius: 8px;
            padding: 2rem;
            position: relative;
            animation: modalEnter 0.3s ease;
        }

        @keyframes modalEnter {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .gallery-carousel {
            margin: 2rem 0;
        }

        .carousel-main {
            height: 500px;
            position: relative;
            overflow: hidden;
            border-radius: 6px;
        }

        .carousel-main img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            position: absolute;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .carousel-main img.active {
            opacity: 1;
        }

        .carousel-nav {
            display: flex;
            gap: 10px;
            margin-top: 1rem;
            overflow-x: auto;
            padding: 10px 0;
        }

        .nav-thumb {
            width: 80px;
            height: 60px;
            flex-shrink: 0;
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.3s;
            border: 2px solid transparent;
        }

        .nav-thumb:hover, .nav-thumb.active {
            opacity: 1;
            border-color: var(--wood);
        }

        .skill-tag {
            display: inline-block;
            background: var(--wood);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            margin: 4px;
            font-size: 0.9rem;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 2rem;
            cursor: pointer;
            color: var(--wood);
            background: none;
            border: none;
        }
    </style>
</head>
<body>
    <div class="portfolio-grid" id="portfolioContainer">
        <div class="loading">Loading projects...</div>
    </div>

    <div class="project-modal" id="projectModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">&times;</button>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        async function fetchProjects() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/GeorgeBradley/matthew/main/feature-project.json');
                if (!response.ok) throw new Error('Failed to fetch data');
                return await response.json();
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('portfolioContainer').innerHTML = 
                    '<p class="error">Error loading projects. Please try again later.</p>';
                return [];
            }
        }

        function createProjectCard(project) {
            const card = document.createElement('div');
            card.className = 'project-card';
            card.innerHTML = `
                <div class="card-thumbnail">
                    <span class="project-type">${project['feature-project-job-category']}</span>
                    <img src="${project['feature-project-thumbnail']}" 
                         alt="${project['feature-project-name']}">
                </div>
                <div class="card-content">
                    <h3>${project['feature-project-name']}</h3>
                    <p>${project['feature-project-description']}</p>
                    <div class="project-meta">
                        <small>${formatYears(project)} • ${project['feature-project-company-name']}</small>
                    </div>
                </div>
            `;
            card.addEventListener('click', () => showProjectModal(project));
            return card;
        }

        function formatYears(project) {
            return `${project['feature-project-start-year']} – 
                   ${project['feature-project-end-year'] || 'Present'}`;
        }

        function showProjectModal(project) {
            const modal = document.getElementById('projectModal');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <h2>${project['feature-project-name']}</h2>
                <div class="project-info">
                    <p><strong>Client:</strong> ${project['feature-project-client']}</p>
                    <p><strong>Duration:</strong> ${formatYears(project)}</p>
                    <div class="skills">
                        ${project['feature-project-skills'].map(skill => 
                            `<span class="skill-tag">${skill}</span>`).join('')}
                    </div>
                </div>
                <div class="gallery-carousel">
                    <div class="carousel-main" id="mainCarousel"></div>
                    <div class="carousel-nav" id="carouselNav"></div>
                </div>
                <p class="project-description">${project['feature-project-description']}</p>
                <a href="${project['feature-project-link']}" target="_blank" class="project-link">
                    View Project Details →
                </a>
            `;

            // Initialize carousel
            const gallery = project['feature-project-gallery'];
            const mainCarousel = document.getElementById('mainCarousel');
            const carouselNav = document.getElementById('carouselNav');

            gallery.forEach((imgData, index) => {
                const mainImg = document.createElement('img');
                mainImg.src = imgData.image;
                mainImg.alt = imgData['alt-text'];
                mainImg.style.display = index === 0 ? 'block' : 'none';
                mainCarousel.appendChild(mainImg);

                const thumb = document.createElement('img');
                thumb.className = `nav-thumb ${index === 0 ? 'active' : ''}`;
                thumb.src = imgData.image;
                thumb.alt = `Thumbnail ${index + 1}`;
                thumb.onclick = () => updateCarousel(index);
                carouselNav.appendChild(thumb);
            });

            modal.style.display = 'block';
        }

        function updateCarousel(index) {
            const images = document.querySelectorAll('#mainCarousel img');
            const thumbs = document.querySelectorAll('.nav-thumb');
            
            images.forEach(img => img.style.display = 'none');
            thumbs.forEach(thumb => thumb.classList.remove('active'));
            
            images[index].style.display = 'block';
            thumbs[index].classList.add('active');
        }

        function closeModal() {
            document.getElementById('projectModal').style.display = 'none';
        }

        // Initialize the portfolio
        async function initialize() {
            const projects = await fetchProjects();
            const container = document.getElementById('portfolioContainer');
            container.innerHTML = '';
            projects.forEach(project => {
                container.appendChild(createProjectCard(project));
            });
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('projectModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Start the application
        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>